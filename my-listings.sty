%% personal config for listings
%% C. Garion, 2012
%%
\NeedsTeXFormat{LaTeX2e}[1995/12/01]
\ProvidesPackage{my-listings}[2012/08/16 v0.1
                 LaTeX package for listings configuration]

% packages
\RequirePackage{listings}
\RequirePackage[scaled=0.85]{luximono}

% new key for line number + first line
\lst@Key{firstlinenum}\relax{\def\lst@firstline{#1\relax}\def\lst@firstnumber{#1\relax}}

% languages definitions
\lstdefinelanguage{svn}{
  morekeywords={checkout,commit,diff,log,
                resolve,revert,svn,update,
                mkdir,switch,merge,copy}
}

\lstdefinelanguage{fh}{
  morekeywords={if,then,else,fi,while,do,od,;,:=}
}

\lstdefinelanguage{mybash}{
  morekeywords={top, man, info, which, cp, ls, mkdir, mv, chmod,
    ssh, scp, rsync, export, ps, pwd, cd, nice, nohup, kill, fg, bg}
}

\lstdefinelanguage[Unity]{C}[ANSI]{C}{
  morekeywords={TEST_GROUP, TEST_SETUP, TEST_TEAR_DOWN, TEST,
    TEST_GROUP_RUNNER, RUN_TEST, RUN_TEST_CASE, TEST_ASSERT_EQUAL_INT,
    TEST_ASSERT_EQUAL_INT32, TEST_ASSERT_INT_WITHIN,
    TEST_ASSERT_EQUAL_STRING, TEST_ASSERT_EQUAL_INT16_ARRAY,
    TEST_ASSERT_DOUBLE_WITHIN, TEST_ASSERT_EQUAL_INT_MESSAGE, TEST_FAIL_MESSAGE
  }
}

\lstdefinelanguage{spass}{
  morekeywords={begin_problem, end_problem,
                end_of_list, list_of_descriptions,
                list_of_symbols, list_of_formulae,
                predicates, functions, formula}
}

\lstdefinelanguage{altergo}{
  morekeywords={type, logic, axiom, goal}
}

\input{jml-junit-listings}

% use lstlinebgrd package for background
\RequirePackage{lstlinebgrd}

% background color + overlays
% Thanks Daniel
% http://tex.stackexchange.com/questions/8851/how-can-i-highlight-some-lines-from-source-code
\makeatletter

\newcount\bt@rangea
\newcount\bt@rangeb

\newcommand\btIfInRange[2]{%
    \global\let\bt@inrange\@secondoftwo%
    \edef\bt@rangelist{#2}%
    \foreach \range in \bt@rangelist {%
        \afterassignment\bt@getrangeb%
        \bt@rangea=0\range\relax%
        \pgfmathtruncatemacro\result{ ( #1 >= \bt@rangea) && (#1 <= \bt@rangeb) }%
        \ifnum\result=1\relax%
            \breakforeach%
            \global\let\bt@inrange\@firstoftwo%
        \fi%
    }%
    \bt@inrange%
}

\newcommand\bt@getrangeb{%
    \@ifnextchar\relax%
        {\bt@rangeb=\bt@rangea}%
        {\@getrangeb}%
}

\def\@getrangeb-#1\relax{%
    \ifx\relax#1\relax%
        \bt@rangeb=100000%   \maxdimen is too large for pgfmath
    \else%
        \bt@rangeb=#1\relax%
    \fi%
}

\newcommand<>{\highlight}[1]{%
  \only#2{\btIfInRange{\value{lstnumber}}{#1}{\color{\lstbackgroundcolor}\def\lst@linebgrdcmd{\color@block}}{\def\lst@linebgrdcmd####1####2####3{}}}%
}%
\makeatother

\def\lstbackgroundcolor{red!30}

% appearance
\RequirePackage{xcolor}
\RequirePackage{caption}

\DeclareCaptionFont{white}{\color{white}}
\DeclareCaptionFormat{listing}{\colorbox{gray}{\parbox{\linewidth}{\hspace{15pt}#1#2#3}}}
\captionsetup[lstlisting]{format=listing,labelfont=white,textfont=white,
  singlelinecheck=false, margin=0pt, font={bf}}

\colorlet{isae@bggray}{gray!20}

% styles
\lstdefinestyle{numbers}
   {numbers=left,xleftmargin=17pt,numbersep=5pt}
\lstdefinestyle{nonumbers}
   {numbers=none,xleftmargin=5pt}
\lstdefinestyle{inline}
   {backgroundcolor=\color{isae@bggray}}
\lstdefinestyle{inline+numbers}
   {backgroundcolor=\color{isae@bggray},numbers=left,numbersep=10pt}

% commands and def
\newcommand{\src}[1]{\lstinline!#1!}
\newcommand{\srcsm}[1]{\bgroup\lstset{basicstyle=\footnotesize\ttfamily}\lstinline!#1!\egroup}

\newcommand{\lstinputlistingsm}[2][]{\lstinputlisting[basicstyle=\footnotesize\ttfamily,#1]{#2}}

\lstnewenvironment{lstlistingsm}
                  {\lstset{basicstyle=\footnotesize\ttfamily}}
                  {}

\lstset{extendedchars=true, basicstyle=\ttfamily, commentstyle=\itshape, showstringspaces=false}
